<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.movision.mybatis.post.mapper.PostMapper">
    <resultMap id="BaseResultMap" type="com.movision.mybatis.post.entity.Post">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="circleid" jdbcType="INTEGER" property="circleid"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="subtitle" jdbcType="VARCHAR" property="subtitle"/>
        <result column="postcontent" jdbcType="VARCHAR" property="postcontent"/>
        <result column="zansum" jdbcType="INTEGER" property="zansum"/>
        <result column="commentsum" jdbcType="INTEGER" property="commentsum"/>
        <result column="forwardsum" jdbcType="INTEGER" property="forwardsum"/>
        <result column="collectsum" jdbcType="INTEGER" property="collectsum"/>
        <result column="isactive" jdbcType="INTEGER" property="isactive"/>
        <result column="activetype" jdbcType="INTEGER" property="activetype"/>
        <result column="activefee" jdbcType="DOUBLE" property="activefee"/>
        <result column="iscontribute" jdbcType="INTEGER" property="iscontribute"/>
        <result column="type" jdbcType="INTEGER" property="type"/>
        <result column="ishot" jdbcType="INTEGER" property="ishot"/>
        <result column="orderid" jdbcType="INTEGER" property="orderid"/>
        <result column="isessence" jdbcType="INTEGER" property="isessence"/>
        <result column="isessencepool" jdbcType="INTEGER" property="isessencepool"/>
        <result column="coverimg" jdbcType="VARCHAR" property="coverimg"/>
        <result column="hotimgurl" jdbcType="VARCHAR" property="hotimgurl"/>
        <result column="intime" jdbcType="TIMESTAMP" property="intime"/>
        <result column="totalpoint" jdbcType="INTEGER" property="totalpoint"/>
        <result column="isdel" jdbcType="INTEGER" property="isdel"/>
        <result column="essencedate" jdbcType="DATE" property="essencedate"/>
        <result column="userid" jdbcType="INTEGER" property="userid"/>
        <result column="oprtime" jdbcType="TIMESTAMP" property="oprtime"/>
    </resultMap>
    <!--BaseColumn-->
    <sql id="Base_Column_List">
        id, circleid, title, subtitle, postcontent, zansum, commentsum, forwardsum, collectsum,
        isactive, activetype, activefee, iscontribute, type, ishot, orderid, isessence, isessencepool, coverimg,
        hotimgurl, intime,totalpoint,isdel,essencedate,userid,oprtime
  </sql>

    <!--基础查询语句-->
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from yw_post
        where id = #{id,jdbcType=INTEGER}
    </select>

    <!--查询当前用户是否点赞过该帖子-->
    <select id="queryIsZanPost" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(*) FROM yw_post_zan_record
        WHERE userid = #{userid,jdbcType=INTEGER}
          AND postid = #{postid,jdbcType=INTEGER}
    </select>

    <!--查询首页今日精选的帖子数据-->
    <select id="queryTodayEssence" resultType="com.movision.mybatis.post.entity.PostVo">
        select * from (
        select
        t1.id,t1.title,t1.subtitle,t1.isactive,t1.type,t1.coverimg,t1.orderid,t1.intime,t1.isessence,t1.isessencepool,t1.isdel,t1.essencedate,
        t1.activetype, t1.activefee, t1.iscontribute, t2.category AS category,t2.code AS code, t3.begintime, t3.endtime
        from yw_post t1
        LEFT JOIN yw_circle t2 ON
        t1.circleid = t2.id
        LEFT JOIN yw_active_period t3 ON
        t1.id = t3.postid
        ) t
        where t.essencedate = DATE_FORMAT(NOW(),'%Y-%m-%d')
        AND t.isessence = '1'
        AND t.isdel = '0'
        order by t.orderid
    </select>

    <!--查询首页dayago天前精选的帖子数据-->
    <select id="queryDayAgoEssence" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostVo">
        select * from (
        select
        t1.id,t1.title,t1.subtitle,t1.isactive,t1.type,t1.coverimg,t1.orderid,t1.intime,t1.isessence,t1.isessencepool,t1.isdel,t1.essencedate,
        t1.activetype, t1.activefee, t1.iscontribute, t2.category AS category,t2.code AS code, t3.begintime, t3.endtime
        from yw_post t1
        LEFT JOIN yw_circle t2 ON
        t1.circleid = t2.id
        LEFT JOIN yw_active_period t3 ON
        t1.id = t3.postid
        ) t
        where TO_DAYS(NOW())-TO_DAYS(t.essencedate) = #{dayago,jdbcType=INTEGER}
        and t.isessence = '1'
        AND t.isdel = '0'
        order by t.orderid
    </select>

    <!--登录时查询用户可能喜欢的圈子-->
    <select id="queryMayLikeCircle" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.circle.entity.Circle">
        SELECT t1.id,t1.category,t1.code,t1.name,t1.maylikeimg FROM yw_circle t1
         WHERE id NOT IN(
        SELECT circleid FROM yw_follow_circle WHERE userid = #{userid,jdbcType=INTEGER})
        AND t1.status = '1'
    </select>

    <!--未登录时查询我们推荐的圈子-->
    <select id="queryRecommendCircle" resultType="com.movision.mybatis.circle.entity.Circle">
        SELECT t1.id,t1.category,t1.code,t1.name,t1.maylikeimg FROM yw_circle t1
        WHERE t1.isrecommend = '1' AND t1.status = '1'
    </select>

    <!--查询yw_post表中所有热门活动列表-->
    <select id="queryHotActiveList" resultType="com.movision.mybatis.post.entity.Post">
        SELECT
        t1.id,t1.title,t1.subtitle,t1.postcontent,t1.isactive,t1.activetype,t1.activefee,t1.iscontribute,t1.ishot,t1.hotimgurl,t1.intime
        FROM yw_post t1 WHERE t1.isactive = '1' AND t1.ishot = '1' AND t1.isdel = '0'
        ORDER BY intime DESC
    </select>

    <!--查询发现页下方推荐的十个圈子中推荐的5个最新热门帖-->
    <select id="queryCircleSubPost" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.Post">
        SELECT t1.id,t1.title,t1.subtitle,t1.isactive,t1.type,t1.ishot,t1.coverimg,t1.isdel,t1.intime
        FROM yw_post t1
        WHERE t1.circleid = #{circleid,jdbcType=INTEGER}
          AND t1.isdel = '0'
          AND t1.ishot = '1'
          AND t1.isactive = '0'
        ORDER BY intime DESC
        LIMIT #{sum,jdbcType=INTEGER}
    </select>

     <!--查询帖子详情-->
    <select id="queryPostDetail" parameterType="java.util.Map"
            resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT t1.*,t2.category AS category,t2.code AS code, t2.name AS circlename,
        <if test="userid != null">
            (SELECT count(*) FROM yw_follow_circle
            WHERE userid = #{userid,jdbcType=INTEGER}
            AND circleid = (SELECT circleid FROM yw_post WHERE id = #{postid,jdbcType=INTEGER})) AS isfollow,
            (SELECT count(*) FROM yw_collection WHERE userid = #{userid,jdbcType=INTEGER} AND postid =
            #{postid,jdbcType=INTEGER} AND type = '0') AS isCollect,
            (SELECT count(*) FROM yw_post_zan_record WHERE userid = #{userid,jdbcType=INTEGER} AND postid =
            #{postid,jdbcType=INTEGER}) AS isZan
        </if>
        <if test="userid == null">
            0 AS isfollow,
            0 AS isCollect,
            0 AS isZan
        </if>
        FROM yw_post t1,yw_circle t2
        WHERE t1.id = #{postid,jdbcType=INTEGER}
          AND t1.circleid = t2.id
    </select>

    <!-- 查询指定帖子所属圈子的id -->
    <select id="queryPostByCircleid" parameterType="java.lang.Integer" resultType="Integer">
        SELECT p.circleid
        FROM yw_post p
        WHERE p.id=#{id,jdbcType=INTEGER}
    </select>

    <!--查询往期3天的精选帖子列表-->
    <select id="queryPastPostList" parameterType="java.util.Map"
            resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT t.* FROM (
        SELECT t1.*,t2.category AS category,t2.code AS code,t2.status
        FROM yw_post t1
        LEFT JOIN (SELECT * FROM yw_circle WHERE status = '1') t2
        ON t1.circleid = t2.id
        ) t
        WHERE t.essencedate <![CDATA[ = ]]> DATE_ADD(#{date},INTERVAL-#{days} DAY)
        AND t.isdel = '0'
        AND t.isessence = '1'
    </select>

    <select id="findAllPostList" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT t1.*,t2.category AS category, t2.code AS code FROM yw_post t1
        LEFT JOIN yw_circle t2 ON
            t1.circleid = t2.id
        WHERE circleid = #{circleid,jdbcType=INTEGER}
        AND t1.isdel = '0'
        ORDER BY intime DESC
        <!-- ORDER BY oprtime DESC, intime DESC-->
    </select>

    <!--查询圈子中推荐的往期所有热帖列表-->
    <select id="findAllPastHotPostList" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT t1.*,t2.category AS category, t2.code AS code FROM yw_post t1
        LEFT JOIN yw_circle t2 ON
        t1.circleid = t2.id
        WHERE circleid = #{circleid,jdbcType=INTEGER}
        AND t1.isdel = '0'
        AND t1.ishot = '1'
          ORDER BY intime DESC
    </select>

    <!--根据圈子id查询当前圈子里所更新的帖子总数-->
    <select id="queryPostNumByCircleid" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT count(1) FROM yw_post
        WHERE circleid = #{circleid,jdbcType=INTEGER}
          AND isdel = '0'
    </select>

    <!--根据圈子id查询该原生视频帖子的视频url-->
    <select id="queryVideoUrl" parameterType="java.lang.Integer" resultType="com.movision.mybatis.video.entity.Video">
        SELECT videourl, bannerimgurl FROM yw_video WHERE postid = #{postid,jdbcType=INTEGER}
    </select>

    <!--查询所有活动列表-->
    <select id="findAllActive" resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT t.* FROM (
        SELECT t1.id, t1.title, t1.subtitle, t1.postcontent, t1.zansum, t1.commentsum, t1.forwardsum, t1.collectsum,
        t1.isactive, t1.activetype, t1.activefee, t1.iscontribute, t1.ishot, t1.isessence, t1.isessencepool, t1.orderid,
        t1.coverimg,
        t1.intime,
        t1.totalpoint, t1.isdel, t2.begintime, t2.endtime
        FROM yw_post t1
        LEFT JOIN yw_active_period t2
        ON t1.id = t2.postid
        ) t WHERE t.isactive = '1'
        ORDER BY t.intime DESC
    </select>

    <!--查询告知类活动详情-->
    <select id="queryNoticeActive" parameterType="java.util.Map"
            resultType="com.movision.mybatis.post.entity.ActiveVo">
        SELECT t.* FROM (
        SELECT t1.*,t2.begintime,t2.endtime
        <if test="userid != null">
            ,(SELECT count(*) FROM yw_collection WHERE userid = #{userid,jdbcType=INTEGER} AND postid =
            #{postid,jdbcType=INTEGER} AND type = '0') AS isCollect,
            (SELECT count(*) FROM yw_post_zan_record WHERE userid = #{userid,jdbcType=INTEGER} AND postid =
            #{postid,jdbcType=INTEGER}) AS isZan,
            (SELECT count(*) FROM yw_active_part WHERE userid = #{userid,jdbcType=INTEGER} AND postid =
            #{postid,jdbcType=INTEGER}) AS isPart
        </if>
        <if test="userid == null">
            ,0 AS isCollect,
            0 AS isZan,
            0 AS isPart
        </if>
        FROM yw_post t1
        LEFT JOIN yw_active_period t2
        ON t1.id = t2.postid
        ) t
        WHERE t.id = #{postid,jdbcType=INTEGER}
    </select>

    <!--查询该用户有没有参与该活动-->
    <select id="queryUserPartSum" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(*) FROM yw_active_part
        WHERE postid = #{postid,jdbcType=INTEGER}
          AND userid = #{userid,jdbcType=INTEGER}
    </select>

    <!--查询该活动的参与总人数-->
    <select id="queryActivePartSum" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT count(*) FROM yw_active_part
        WHERE postid = #{postid,jdbcType=INTEGER}
    </select>

    <!--查询用户发布的历史帖子和用户分享出去的历史帖子(这里取的是分享时间)-->
    <select id="findAllPersonPost" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostVo">
        SELECT a.*,b.name AS circlename FROM (
            (
        SELECT id, circleid, title, subtitle, coverimg, intime, isactive, activetype, type
                FROM yw_post
        WHERE userid = #{userid,jdbcType=INTEGER}
        AND isactive = '0'
        AND isdel = '0'
            )
          UNION
            (
        SELECT t.id, t.circleid, t.title, t.subtitle, t.coverimg, t.isactive, t.activetype, t.type, t1.intime FROM (
        SELECT id, circleid, title, subtitle, coverimg, intime, isactive, activetype, type
        FROM yw_post
        WHERE id IN (
        SELECT postid FROM yw_post_share WHERE userid = #{userid,jdbcType=INTEGER}
        )
        AND isactive = '0'
        AND isdel = '0'
                ) t LEFT JOIN yw_post_share t1 ON t.id = t1.postid
            )
        ) a LEFT JOIN yw_circle b ON a.circleid = b.id
    </select>

    <!--查询用户参与过的历史活动列表-->
    <select id="findAllPersonActive" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.ActiveVo">
        SELECT * FROM (
        SELECT t1.id, t1.title, t1.subtitle, t1.coverimg, t1.isactive, t1.activetype, t1.type, t2.begintime, t2.endtime
            FROM yw_post t1
            LEFT JOIN yw_active_period t2
             ON t1.id = t2.postid
            ) t
        WHERE t.id IN (
             SELECT postid FROM yw_active_part WHERE userid = #{userid,jdbcType=INTEGER}
         )
    </select>

    <!--根据userid查询用户所有收藏的商品列表-->
    <select id="queryCollectGoodsList" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.goods.entity.Goods">
        SELECT t1.*, t2.img_url FROM (
        SELECT id, name FROM yw_goods WHERE id IN (
        SELECT goodsid FROM yw_collection WHERE userid = #{userid,jdbcType=INTEGER}
        )
        ) t1 LEFT JOIN (SELECT * FROM yw_goods_img WHERE type = '2') t2
        ON t1.id = t2.goodsid
    </select>

    <!--userid为空时查询所有商品列表-->
    <select id="findAllGoodsList" resultType="com.movision.mybatis.goods.entity.Goods">
        SELECT t1.*, t2.img_url FROM (
        SELECT id, name FROM yw_goods
        ) t1 LEFT JOIN (SELECT * FROM yw_goods_img WHERE type = '2') t2
        ON t1.id = t2.goodsid
    </select>

    <!--查询活动最下方推荐的四个热门活动-->
    <select id="queryFourHotActive" resultType="com.movision.mybatis.post.entity.ActiveVo">
        SELECT * FROM yw_post WHERE isactive='1' ORDER BY intime DESC limit 0,4
    </select>

    <!--查询往期精选右上角选择的日期枚举-->
    <select id="findAllDateSelect" resultType="java.util.Date">
        SELECT DISTINCT essencedate FROM yw_post WHERE isdel = '0' AND (essencedate != 'NULL' AND essencedate != '' AND
        now() > essencedate) ORDER BY essencedate DESC
    </select>

    <!--基础删除语句-->
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        delete from yw_post
        where id = #{id,jdbcType=INTEGER}
    </delete>

    <!--APP端删除帖子接口-->
    <delete id="delPost" parameterType="java.util.Map">
        UPDATE yw_post
        SET isdel=1
        WHERE id=#{postid,jdbcType=INTEGER} AND userid = #{userid,jdbcType=INTEGER}
    </delete>

    <!--基础插入语句（无判断全量）-->
    <insert id="insert" parameterType="com.movision.mybatis.post.entity.Post">
    insert into yw_post (id, circleid, title, 
      subtitle, postcontent, zansum,
        commentsum, forwardsum, collectsum,
        isactive, activetype, activefee, iscontribute, type, ishot, orderid,
        isessence, isessencepool, coverimg, hotimgurl,
        intime, totalpoint, isdel, essencedate,userid,oprtime
      )
    values (#{id,jdbcType=INTEGER}, #{circleid,jdbcType=INTEGER}, #{title,jdbcType=VARCHAR}, 
      #{subtitle,jdbcType=VARCHAR}, #{postcontent,jdbcType=VARCHAR}, #{zansum,jdbcType=INTEGER},
        #{commentsum,jdbcType=INTEGER}, #{forwardsum,jdbcType=INTEGER}, #{collectsum,jdbcType=INTEGER},
        #{isactive,jdbcType=INTEGER}, #{activetype,jdbcType=INTEGER}, #{activefee,jdbcType=DOUBLE},
        #{iscontribute,jdbcType=INTEGER},#{type,jdbcType=INTEGER},
        #{ishot,jdbcType=INTEGER}, #{orderid,jdbcType=INTEGER},#{isessence,jdbcType=INTEGER},
        #{isessencepool,jdbcType=INTEGER}, #{coverimg,jdbcType=VARCHAR},#{hotimgurl,jdbcType=VARCHAR},
        #{intime,jdbcType=TIMESTAMP}, #{totalpoint,jdbcType=INTEGER}, #{isdel,jdbcType=INTEGER},
        #{essencedate,jdbcType=DATE},#{userid,jdbcType=INTEGER},#{oprtime,jdbcType=TIMESTAMP}
      )
  </insert>

    <!--APP端发布普通帖-->
    <insert id="releasePost" parameterType="com.movision.mybatis.post.entity.Post">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        INSERT INTO yw_post (circleid, title,
          postcontent, zansum, commentsum, forwardsum,
        collectsum, isactive, type, ishot, isessence,
        isessencepool, coverimg, intime, totalpoint, isdel, essencedate, userid,oprtime
        )
        VALUES (
          #{circleid,jdbcType=INTEGER},#{title,jdbcType=VARCHAR},#{postcontent,jdbcType=VARCHAR},
          #{zansum,jdbcType=INTEGER},#{commentsum,jdbcType=INTEGER},#{forwardsum,jdbcType=INTEGER},
          #{collectsum,jdbcType=INTEGER},#{isactive,jdbcType=INTEGER},#{type,jdbcType=INTEGER},
          #{ishot,jdbcType=INTEGER},#{isessence,jdbcType=INTEGER},#{isessencepool,jdbcType=INTEGER},
        #{coverimg,jdbcType=VARCHAR},#{intime,jdbcType=TIMESTAMP},#{totalpoint,jdbcType=INTEGER},#{isdel,jdbcType=INTEGER},
        #{essencedate,jdbcType=DATE},#{userid,jdbcType=INTEGER},#{oprtime,jdbcType=TIMESTAMP}
        )
    </insert>

    <!--插入一条用户参与活动的记录-->
    <insert id="saveActiveRecord" parameterType="java.util.Map">
      INSERT INTO yw_active_part (
        postid, userid, title, email, introduction
      )
      VALUES (
        #{postid,jdbcType=INTEGER}, #{userid,jdbcType=INTEGER}, #{title,jdbcType=VARCHAR},
        #{email,jdbcType=VARCHAR}, #{introduction,jdbcType=VARCHAR}
      )
    </insert>

    <!--批量插入发布帖子时分享的所有商品-->
    <insert id="insertPostShareGoods" parameterType="java.util.List">
        INSERT INTO yw_post_share_goods (
        postid, goodsid
        )
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.postid,jdbcType=INTEGER},#{item.goodsid,jdbcType=INTEGER})
        </foreach>
    </insert>

    <!--插入一条用户点赞帖子的记录-->
    <insert id="insertZanRecord" parameterType="java.util.Map">
      INSERT INTO yw_post_zan_record (
        userid, postid, intime
      )
      VALUES (
        #{userid,jdbcType=INTEGER}, #{postid,jdbcType=INTEGER}, #{intime,jdbcType=TIMESTAMP}
      )
    </insert>

    <insert id="addPost" parameterType="java.util.Map">
        INSERT INTO yw_post(
        <if test="title != null">
            title,
        </if>
        <if test="type != null">
            type,
        </if>
        <if test="circleid != null">
            circleid,
        </if>
        <if test="coverimg != null">
            coverimg,
        </if>
        <if test="man != null">
            man,
        </if>
        <if test="postcontent != null">
            postcontent,
        </if>
        <if test="isessence != null">
            isessence,
        </if>
        <if test="time != null">
            time,
        </if>
        <if test="intime != null">
            intime,
        </if>
        <if test="userid!=null">
            userid,
        </if>
        <if test="oprtime!=null">
            oprtime,
        </if>
        )
        VALUES (
        <if test="title != null">
            #{title,jdbcType=VARCHAR},
        </if>
        <if test="ype != null">
            #{ype,jdbcType=INTEGER},
        </if>
        <if test="circleid != null">
            #{circleid,jdbcType=INTEGER},
        </if>
        <if test="coverimg != null">
            #{coverimg,jdbcType=VARCHAR},
        </if>
        <if test="man != null">
            #{man,jdbcType=VARCHAR},
        </if>
        <if test="postcontent != null">
            #{postcontent,jdbcType=VARCHAR},
        </if>
        <if test="isessence != null">
            #{isessence,jdbcType=INTEGER},
        </if>
        <if test="time != null">
            #{time,jdbcType=TIMESTAMP},
        </if>
        <if test="intime != null">
            #{intime,jdbcType=TIMESTAMP},
        </if>
        <if test="userid != null">
            #{userid,jdbcType=INTEGER},
        </if>
        <if test="oprtime!=null">
            #{oprtime,jdbcType=TIMESTAMP},
        </if>
        )
    </insert>

    <!--基础插入语句（选择性插入）-->
    <insert id="insertSelective" parameterType="com.movision.mybatis.post.entity.Post">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        insert into yw_post
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="circleid != null">
                circleid,
            </if>
            <if test="title != null">
                title,
            </if>
            <if test="subtitle != null">
                subtitle,
            </if>
            <if test="postcontent != null">
                postcontent,
            </if>
            <if test="zansum != null">
                zansum,
            </if>
            <if test="commentsum != null">
                commentsum,
            </if>
            <if test="forwardsum != null">
                forwardsum,
            </if>
            <if test="collectsum != null">
                collectsum,
            </if>
            <if test="isactive != null">
                isactive,
            </if>
            <if test="activetype != null">
                activetype,
            </if>
            <if test="activefee != null">
                activefee,
            </if>
            <if test="iscontribute !=null">
                iscontribute,
            </if>
            <if test="type != null">
                type,
            </if>
            <if test="ishot != null">
                ishot,
            </if>
            <if test="orderid != null">
                orderid,
            </if>
            <if test="isessence != null">
                isessence,
            </if>
            <if test="isessencepool != null">
                isessencepool,
            </if>
            <if test="coverimg != null">
                coverimg,
            </if>
            <if test="hotimgurl != null">
                hotimgurl,
            </if>
            <if test="intime != null">
                intime,
            </if>
            <if test="totalpoint != null">
                totalpoint,
            </if>
            <if test="isdel != null">
                isdel,
            </if>
            <if test="essencedate != null">
                essencedate,
            </if>
            <if test="userid !=null">
                userid,
            </if>
            <if test="oprtime != null">
                oprtime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="circleid != null">
                #{circleid,jdbcType=INTEGER},
            </if>
            <if test="title != null">
                #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="zansum != null">
                #{zansum,jdbcType=INTEGER},
            </if>
            <if test="commentsum != null">
                #{commentsum,jdbcType=INTEGER},
            </if>
            <if test="forwardsum != null">
                #{forwardsum,jdbcType=INTEGER},
            </if>
            <if test="collectsum != null">
                #{collectsum,jdbcType=INTEGER},
            </if>
            <if test="isactive != null">
                #{isactive,jdbcType=INTEGER},
            </if>
            <if test="activetype != null">
                #{activetype,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="iscontribute != null">
                #{iscontribute,jdbcType=INTEGER},
            </if>
            <if test="type != null">
                #{type,jdbcType=INTEGER},
            </if>
            <if test="ishot != null">
                #{ishot,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                #{isessence,jdbcType=INTEGER},
            </if>
            <if test="isessencepool != null">
                #{isessencepool,jdbcType=INTEGER},
            </if>
            <if test="coverimg != null">
                #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="hotimgurl != null">
                #{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="intime != null">
                #{intime,jdbcType=TIMESTAMP},
            </if>
            <if test="totalpoint != null">
                #{totalpoint,jdbcType=INTEGER},
            </if>
            <if test="isdel != null">
                #{isdel,jdbcType=INTEGER},
            </if>
            <if test="essencedate != null">
                #{essencedate,jdbcType=DATE},
            </if>
            <if test="userid!=null">
                #{userid,jdbcType=INTEGER},
            </if>
            <if test="oprtime !=null">
                #{oprtime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <!--基础插入语句（选择性插入）-->
    <insert id="insertSelectivet" parameterType="com.movision.mybatis.post.entity.PostTo">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        insert into yw_post
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="circleid != null">
                circleid,
            </if>
            <if test="title != null">
                title,
            </if>
            <if test="subtitle != null">
                subtitle,
            </if>
            <if test="postcontent != null">
                postcontent,
            </if>
            <if test="zansum != null">
                zansum,
            </if>
            <if test="commentsum != null">
                commentsum,
            </if>
            <if test="forwardsum != null">
                forwardsum,
            </if>
            <if test="collectsum != null">
                collectsum,
            </if>
            <if test="isactive != null">
                isactive,
            </if>
            <if test="activetype != null">
                activetype,
            </if>
            <if test="activefee != null">
                activefee,
            </if>
            <if test="type != null">
                type,
            </if>
            <if test="ishot != null">
                ishot,
            </if>
            <if test="orderid != null">
                orderid,
            </if>
            <if test="isessence != null">
                isessence,
            </if>
            <if test="isessencepool != null">
                isessencepool,
            </if>
            <if test="coverimg != null">
                coverimg,
            </if>
            <if test="hotimgurl != null">
                hotimgurl,
            </if>
            <if test="intime != null">
                intime,
            </if>
            <if test="totalpoint != null">
                totalpoint,
            </if>
            <if test="isdel != null">
                isdel,
            </if>
            <if test="essencedate != null">
                essencedate,
            </if>
            <if test="userid !=null">
                userid,
            </if>
            <if test="oprtime != null">
                oprtime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="circleid != null">
                #{circleid,jdbcType=INTEGER},
            </if>
            <if test="title != null">
                #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="zansum != null">
                #{zansum,jdbcType=INTEGER},
            </if>
            <if test="commentsum != null">
                #{commentsum,jdbcType=INTEGER},
            </if>
            <if test="forwardsum != null">
                #{forwardsum,jdbcType=INTEGER},
            </if>
            <if test="collectsum != null">
                #{collectsum,jdbcType=INTEGER},
            </if>
            <if test="isactive != null">
                #{isactive,jdbcType=INTEGER},
            </if>
            <if test="activetype != null">
                #{activetype,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="type != null">
                #{type,jdbcType=INTEGER},
            </if>
            <if test="ishot != null">
                #{ishot,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                #{isessence,jdbcType=INTEGER},
            </if>
            <if test="isessencepool != null">
                #{isessencepool,jdbcType=INTEGER},
            </if>
            <if test="coverimg != null">
                #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="hotimgurl != null">
                #{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="intime != null">
                #{intime,jdbcType=TIMESTAMP},
            </if>
            <if test="totalpoint != null">
                #{totalpoint,jdbcType=INTEGER},
            </if>
            <if test="isdel != null">
                #{isdel,jdbcType=INTEGER},
            </if>
            <if test="essencedate != null">
                #{essencedate,jdbcType=TIMESTAMP},
            </if>
            <if test="userid!=null">
                #{userid,jdbcType=INTEGER},
            </if>
            <if test="oprtime != null">
                #{oprtime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <!--基础update语句（有判断）-->
    <update id="updateByPrimaryKeySelective" parameterType="com.movision.mybatis.post.entity.Post">
        update yw_post
        <set>
            <if test="circleid != null">
                circleid = #{circleid,jdbcType=INTEGER},
            </if>
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                subtitle = #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                postcontent = #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="zansum != null">
                zansum = #{zansum,jdbcType=INTEGER},
            </if>
            <if test="commentsum != null">
                commentsum = #{commentsum,jdbcType=INTEGER},
            </if>
            <if test="forwardsum != null">
                forwardsum = #{forwardsum,jdbcType=INTEGER},
            </if>
            <if test="collectsum != null">
                collectsum = #{collectsum,jdbcType=INTEGER},
            </if>
            <if test="isactive != null">
                isactive = #{isactive,jdbcType=INTEGER},
            </if>
            <if test="activetype != null">
                activetype = #{activetype,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                activefee = #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="iscontribute != null">
                iscontribute = #{iscontribute,jdbcType=INTEGER},
            </if>
            <if test="type != null">
                type = #{type,jdbcType=INTEGER},
            </if>
            <if test="ishot != null">
                ishot = #{ishot,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                orderid=#{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                isessence = #{isessence,jdbcType=INTEGER},
            </if>
            <if test="isessencepool != null">
                isessencepool = #{isessencepool,jdbcType=INTEGER},
            </if>
            <if test="coverimg != null">
                coverimg = #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="hotimgurl != null">
                hotimgurl = #{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="intime != null">
                intime = #{intime,jdbcType=TIMESTAMP},
            </if>
            <if test="totalpoint != null">
                totalpoint = #{totalpoint,jdbcType=INTEGER},
            </if>
            <if test="isdel != null">
                isdel = #{isdel,jdbcType=INTEGER},
            </if>
            <if test="essencedate != null">
                essencedate = #{essencedate,jdbcType=TIMESTAMP},
            </if>
            <if test="userid != null">
                userid = #{userid,jdbcType=INTEGER},
            </if>
            <if test="oprtime != null">
                oprtime=#{oprtime,jdbcType=TIMESTAMP}
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateActiveById" parameterType="com.movision.mybatis.post.entity.PostActiveList">
        update yw_post
        <set>
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                subtitle = #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                postcontent = #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="activetype != null">
                activetype = #{activetype,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                orderid=#{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                isessence = #{isessence,jdbcType=INTEGER},
            </if>
            <if test="coverimg != null">
                coverimg = #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="essencedate != null">
                essencedate = #{essencedate,jdbcType=TIMESTAMP},
            </if>
            <if test="userid != null">
                userid = #{userid,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                activefee = #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="iscontribute!=null">
                iscontribute=#{iscontribute,jdbcType=INTEGER},
            </if>
            <if test="hotimgurl!=null">
                hotimgurl=#{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="ishot!=null">
                ishot=#{ishot,jdbcType=INTEGER},
            </if>
            <if test="oprtime!=null">
                oprtime=#{oprtime,jdbcType=TIMESTAMP}
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateActiveByIdP" parameterType="com.movision.mybatis.period.entity.Period">
        UPDATE yw_active_period
        <set>
            <if test="begintime != null">
                begintime = #{begintime,jdbcType=TIMESTAMP},
            </if>
            <if test="endtime != null">
                endtime = #{endtime,jdbcType=TIMESTAMP},
            </if>
        </set>
        WHERE postid=#{postid,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKeySelectiveById" parameterType="com.movision.mybatis.post.entity.PostTo">
        update yw_post
        <set>
            <if test="circleid != null">
                circleid = #{circleid,jdbcType=INTEGER},
            </if>
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                subtitle = #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                postcontent = #{postcontent,jdbcType=VARCHAR},
            </if>

            <if test="type != null">
                type = #{type,jdbcType=INTEGER},
            </if>
            <if test="ishot != null">
                ishot = #{ishot,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                orderid=#{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                isessence = #{isessence,jdbcType=INTEGER},
            </if>
            <if test="coverimg != null">
                coverimg = #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="intime != null">
                intime = #{intime,jdbcType=TIMESTAMP},
            </if>
            <if test="essencedate != null">
                essencedate = #{essencedate,jdbcType=DATE},
            </if>
            <if test="userid != null">
                userid = #{userid,jdbcType=INTEGER},
            </if>
            <if test="oprtime!=null">
                oprtime=#{oprtime,jdbcType=TIMESTAMP}
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>

    <!--基础update语句（无判断全量修改）-->
    <update id="updateByPrimaryKey" parameterType="com.movision.mybatis.post.entity.Post">
    update yw_post
    set circleid = #{circleid,jdbcType=INTEGER},
      title = #{title,jdbcType=VARCHAR},
      subtitle = #{subtitle,jdbcType=VARCHAR},
      postcontent = #{postcontent,jdbcType=VARCHAR},
      zansum = #{zansum,jdbcType=INTEGER},
      commentsum = #{commentsum,jdbcType=INTEGER},
      forwardsum = #{forwardsum,jdbcType=INTEGER},
      collectsum = #{collectsum,jdbcType=INTEGER},
      isactive = #{isactive,jdbcType=INTEGER},
        activetype = #{activetype,jdbcType=INTEGER},
        activefee = #{activefee,jdbcType=DOUBLE},
        iscontribute = #{iscontribute,jdbcType=INTEGER},
      type = #{type,jdbcType=INTEGER},
      ishot = #{ishot,jdbcType=INTEGER},
      orderid = #{orderid,jdbcType=INTEGER},
      isessence = #{isessence,jdbcType=INTEGER},
        isessencepool = #{isessencepool,jdbcType=INTEGER},
      coverimg = #{coverimg,jdbcType=VARCHAR},
        hotimgurl = #{hotimgurl,jdbcType=VARCHAR},
      intime = #{intime,jdbcType=TIMESTAMP},
      totalpoint = #{totalpoint,jdbcType=INTEGER},
        isdel = #{isdel,jdbcType=INTEGER},
        essencedate = #{essencedate,jdbcType=DATE},
        userid=#{userid,jdbcType=INTEGER},
        oprtime=#{oprtime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
    <update id="updatePostByZanSum" parameterType="java.lang.Integer">
        UPDATE yw_post
        SET zansum = zansum+1
        WHERE id=#{id,jdbcType=INTEGER}
    </update>

    <!--用户取消收藏帖子后更新帖子被收藏的总次数-->
    <update id="updatePostCollectCount" parameterType="java.util.Map">
        UPDATE yw_post
        SET collectsum = collectsum - 1
        WHERE id=#{postid,jdbcType=INTEGER}
    </update>

    <!--用户分享帖子或活动后更新被分享的总次数-->
    <update id="updatePostShareNum" parameterType="java.util.Map">
        UPDATE yw_post
        SET forwardsum = forwardsum + 1
        WHERE id=#{postid,jdbcType=INTEGER}
    </update>

    <select id="queryPostByZanSum" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT p.zansum
        FROM yw_post p
        WHERE id=#{id,jdbcType=INTEGER}
    </select>

    <update id="updatePostBycommentsum" parameterType="java.lang.Integer">
        UPDATE yw_post
        SET commentsum=commentsum+1,
        oprtime = now()
        WHERE id=#{postid,jdbcType=INTEGER}
    </update>

    <update id="updatePostBycommentsumT" parameterType="java.lang.Integer">
        UPDATE yw_post
        SET commentsum=commentsum+1,
        oprtime = now()
        WHERE id=(SELECT postid FROM yw_post_comment WHERE id=#{postid,jdbcType=INTEGER})
    </update>

    <!-- 查询帖子列表 -->
    <select id="findAllqueryPostByList2" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        AND circleid in (SELECT id FROM yw_circle WHERE phone=(SELECT phone FROM yw_admin_user WHERE
        id=#{userid,jdbcType=INTEGER}))
        ORDER BY p.intime DESC
    </select>

    <select id="findAllqueryPostByManageByList" parameterType="java.util.List"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        <if test="uid!=null">
            AND u.id=#{uid,jdbcType=INTEGER}
        </if>
        <if test="price==5">
            AND p.isactive=0
        </if>
        <if test="price==6">
            AND p.isessence=1
        </if>
        <if test="title!=null">
            AND p.title LIKE concat('%',#{title,jdbcType=VARCHAR},'%')
        </if>
        <if test="userid!=null">
            AND p.userid=#{userid,jdbcType=INTEGER}
        </if>
        <if test="postcontent!=null">
            AND p.postcontent LIKE concat('%',#{postcontent,jdbcType=VARCHAR},'%')
        </if>
        <if test="circleid!=null">
            AND p.circleid=#{circleid,jdbcType=INTEGER}
        </if>
        <if test="endtime!=null and begintime!=null">
            AND p.intime BETWEEN #{begintime,jdbcType=DATE} AND #{endtime,jdbcType=DATE}
        </if>
        <if test="essencedate!=null">
            AND p.essencedate=#{essencedate,jdbcType=DATE}
        </if>
        AND p.circleid IN (SELECT circleid FROM yw_circle_manager WHERE userid=#{userid,jdbcType=INTEGER})
        <!--<foreach collection="list" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>-->
        <if test="pai==0">
            ORDER BY p.intime DESC
        </if>
        <if test="pai==1">
            ORDER BY p.totalpoint DESC
        </if>
    </select>

    <!-- 查询帖子列表2 -->
    <select id="findAllqueryPostByList" resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        ORDER BY p.intime DESC
    </select>

    <select id="findAllqueryPostByCircleId" parameterType="java.util.Map"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        AND p.circleid=#{circleid,jdbcType=INTEGER}
        <if test="type==1">
            AND date(p.intime)=curdate()
        </if>
        <if test="type==2">
            AND p.isessence=1
        </if>
        ORDER BY p.intime DESC
    </select>

    <select id="findAllQueryPostListByUserid" resultType="com.movision.mybatis.post.entity.PostList"
            parameterType="java.util.Map">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        AND p.userid=#{userid,jdbcType=INTEGER}
        <if test="type==2">
            AND p.isessence=1
        </if>
        ORDER BY p.intime DESC
    </select>

    <select id="findAllQueryCollectionListByUserid" parameterType="java.lang.String"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0
        (SELECT postid FROM yw_collection WHERE postid IN (SELECT id FROM yw_post WHERE
        userid=#{userid,jdbcType=INTEGER} AND isdel=0) AND type=0)
        ORDER BY p.intime DESC
    </select>

    <select id="findAllquerySharePostList" parameterType="java.lang.String"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0 AND p.id IN
        (SELECT postid FROM yw_post_share WHERE postid IN
        (SELECT id FROM yw_post WHERE userid=#{userid,jdbcType=INTEGER}) GROUP BY postid)
        ORDER BY p.intime DESC
    </select>

    <!--查询精贴列表-->
    <select id="findAllIsessenceByList" parameterType="java.util.Map"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.id,p.title,p.collectsum,p.commentsum,p.zansum,p.intime,
        p.totalpoint,p.isessence,p.orderid,p.essencedate,
        (SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) AS nickname,
        (SELECT COUNT(1) FROM yw_post_share WHERE postid=p.id) AS share,
        (SELECT COALESCE(SUM(points),0) FROM yw_post_rewarded WHERE postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(num),0) FROM yw_post_accusation WHERE postid =p.id) AS accusation,
        (SELECT name FROM yw_circle WHERE id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
        (SELECT category FROM yw_circle WHERE id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
        FROM yw_post p WHERE 1
        <if test="circleid!=null">
            AND p.circleid =#{circleid,jdbcType=INTEGER}
        </if>
        <if test="categoryid!=null">
            AND p.circleid IN (SELECT id FROM yw_circle WHERE category=#{categoryid,jdbcType=INTEGER})
        </if>
        AND isessence=1 AND p.isdel=0 ORDER BY p.intime DESC
     </select>

    <!--查询活动列表草稿箱-->
    <select id="findAllActiveByList" resultType="com.movision.mybatis.post.entity.PostList">
        SELECT * FROM yw_post WHERE isdel=0 AND isactive=1 ORDER  BY intime DESC
    </select>
    <!--查询活动列表-->
    <select id="findAllActiveTOByList" resultType="com.movision.mybatis.post.entity.PostActiveList">
        SELECT * FROM yw_post WHERE isdel=0 AND isactive=1
        <if test="loginid!=null">
            AND userid=#{loginid,jdbcType=INTEGER}
        </if>
        ORDER BY intime DESC
    </select>
    <!-- 逻辑删除帖子 -->
    <update id="deletePost" parameterType="java.lang.Integer">
        UPDATE yw_post
        SET isdel=1
        WHERE id=#{postid,jdbcType=INTEGER}
    </update>

    <select id="queryPostParticulars" resultType="com.movision.mybatis.post.entity.PostList"
            parameterType="java.lang.Integer">
        SELECT p.*,
        (SELECT COUNT(1) FROM yw_post_share WHERE postid=p.id) AS share,
        (SELECT COALESCE(SUM(points),0) FROM yw_post_rewarded WHERE postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(num),0) FROM yw_post_accusation WHERE postid =p.id) AS accusation,
        (SELECT nickname FROM yw_user WHERE id=(SELECT userid FROM yw_post WHERE id=p.id AND isactive=0 AND isdel=0)) AS
        nickname,
        (SELECT name FROM yw_circle WHERE id=(SELECT circleid FROM yw_post WHERE id=p.id AND isactive=0 AND isdel=0)) AS
        circlename,
        (SELECT category FROM yw_circle WHERE id=(SELECT circleid FROM yw_post WHERE id=p.id AND isactive=0 AND
        isdel=0)) AS category,
        (SELECT categoryname FROM yw_circle_category WHERE id=(SELECT category FROM yw_circle WHERE id=(SELECT circleid
        FROM yw_post WHERE id=p.id AND isactive=0 AND
        isdel=0))) AS categoryname,
        v.videourl vid,v.bannerimgurl
        FROM yw_post p LEFT JOIN yw_video as v ON p.id=v.postid
        WHERE p.id=#{postid,jdbcType=INTEGER} AND p.isactive=0 AND p.isdel=0
    </select>

    <select id="queryActivityParticulars" resultType="com.movision.mybatis.post.entity.PostList"
            parameterType="java.lang.Integer">
        SELECT p.*,
        (SELECT COUNT(1) FROM yw_post_share WHERE postid=p.id) AS share,
        (SELECT COALESCE(SUM(points),0) FROM yw_post_rewarded WHERE postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(num),0) FROM yw_post_accusation WHERE postid =p.id) AS accusation,
        (SELECT nickname FROM yw_user WHERE id=(SELECT userid FROM yw_post WHERE id=p.id AND isactive=1 AND isdel=0)) AS
        nickname,
        (SELECT name FROM yw_circle WHERE id=(SELECT circleid FROM yw_post WHERE id=p.id AND isactive=1 AND isdel=0)) AS
        circlename,
        (SELECT category FROM yw_circle WHERE id=(SELECT circleid FROM yw_post WHERE id=p.id AND isactive=1 AND
        isdel=0)) AS category
        FROM yw_post p
        WHERE p.id=#{postid,jdbcType=INTEGER} AND p.isactive=1 AND p.isdel=0
    </select>

    <select id="queryPostNumAndisessenceByCircleid" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostNum">
        SELECT COUNT(1) postnum,
        (SELECT COUNT(1) FROM yw_post WHERE circleid=#{circleid,jdbcType=INTEGER} AND isessence=1 AND isdel=0) as
        isessence
        FROM yw_post WHERE circleid=#{circleid,jdbcType=INTEGER} AND isdel=0 AND isactive=0
    </select>

    <update id="addPostChoiceness" parameterType="com.movision.mybatis.post.entity.PostTo">
        UPDATE yw_post SET
        <if test="essencedate != null">
            essencedate = #{essencedate,jdbcType=DATE},
        </if>
        <if test="subtitle!=null">
            subtitle=#{subtitle,jdbcType=VARCHAR},
        </if>
        <if test="orderid!=null">
            orderid=#{orderid,jdbcType=INTEGER},
        </if>
        isessence=1,
        isessencepool=0
        WHERE id=#{id,jdbcType=INTEGER} AND isessence=0
    </update>
    <select id="findAllPerson" resultType="java.lang.Integer" parameterType="java.lang.Integer">
        SELECT COUNT(1) persum FROM yw_active_part WHERE postid=#{postid,jdbcType=INTEGER}
    </select>


    <select id="queryPostChoicenesslist" resultType="com.movision.mybatis.post.entity.PostTo"
            parameterType="java.util.Map">
        SELECT orderid,essencedate FROM yw_post WHERE essencedate=#{esdate,jdbcType=DATE} AND isessence=1 AND isdel=0
        GROUP BY orderid
    </select>

    <select id="queryPostIsessence" resultType="com.movision.mybatis.post.entity.Post">
        SELECT orderid FROM yw_post WHERE DATE(intime)=CURDATE() AND isessence=1 AND isdel=0 AND isactive=0 GROUP BY
        orderid DESC
    </select>

    <select id="queryPostChoiceness" resultType="com.movision.mybatis.post.entity.PostChoiceness"
            parameterType="java.lang.Integer">
        SELECT id,subtitle,essencedate,orderid FROM yw_post WHERE id=#{postid,jdbcType=INTEGER} AND isdel=0
    </select>

    <update id="deletePostChoiceness" parameterType="java.lang.Integer">
        UPDATE yw_post SET isessence=0,essencedate=null,orderid=NULL WHERE id=#{postid,jdbcType=INTEGER}
    </update>


    <select id="findAllActivefee" resultType="java.lang.Double" parameterType="java.lang.Integer">
        SELECT t.activefee FROM yw_post t WHERE t.isactive=1 AND t.isdel=0 AND t.id in (SELECT e.postid FROM
        yw_active_part e WHERE e.postid=#{postid,jdbcType=INTEGER})
    </select>

    <!--基础插入语句（选择性插入）-->
    <insert id="insertActive" parameterType="com.movision.mybatis.post.entity.Post">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        insert into yw_post
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="title != null">
                title,
            </if>
            <if test="subtitle != null">
                subtitle,
            </if>
            <if test="postcontent != null">
                postcontent,
            </if>

            <if test="isactive != null">
                isactive,
            </if>
            <if test="activetype != null">
                activetype,
            </if>
            <if test="activefee != null">
                activefee,
            </if>
            <if test="iscontribute != null">
                iscontribute,
            </if>
            <if test="orderid != null">
                orderid,
            </if>
            <if test="isessence != null">
                isessence,
            </if>
             <if test="coverimg != null">
                coverimg,
            </if>
            <if test="hotimgurl != null">
                hotimgurl,
            </if>
            <if test="intime != null">
                intime,
            </if>
             <if test="essencedate != null">
                essencedate,
            </if>
            <if test="userid !=null">
                userid,
            </if>
            <if test="oprtime!=null">
                oprtime
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>

            <if test="title != null">
                #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                #{subtitle,jdbcType=VARCHAR},
            </if>

            <if test="postcontent != null">
                #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="isactive != null">
                #{isactive,jdbcType=INTEGER},
            </if>
            <if test="activetype != null">
                #{activetype,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="iscontribute != null">
                #{iscontribute,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=INTEGER},
            </if>
            <if test="isessence != null">
                #{isessence,jdbcType=INTEGER},
            </if>
             <if test="coverimg != null">
                #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="hotimgurl != null">
                #{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="intime != null">
                #{intime,jdbcType=TIMESTAMP},
            </if>
              <if test="essencedate != null">
                  #{essencedate,jdbcType=DATE},
              </if>
            <if test="userid!=null">
                #{userid,jdbcType=INTEGER},
            </if>
            <if test="oprtime!=null">
                #{oprtime,jdbcType=TIMESTAMP}
            </if>
        </trim>
    </insert>

    <!--基础插入语句（选择性插入）-->
    <insert id="insertActivet" parameterType="com.movision.mybatis.post.entity.PostTo">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        insert into yw_post
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="title != null">
                title,
            </if>
            <if test="subtitle != null">
                subtitle,
            </if>
            <if test="activetype != null">
                activetype,
            </if>
            <if test="activefee != null">
                activefee,
            </if>
            <if test="coverimg != null">
                coverimg,
            </if>
            <if test="postcontent != null">
                postcontent,
            </if>
            <if test="isessence != null">
                isessence,
            </if>
            <if test="orderid != null">
                orderid,
            </if>
            <if test="essencedate != null">
                essencedate,
            </if>
            <if test="isactive != null">
                isactive,
            </if>
            <if test="intime != null">
                intime,
            </if>
            <if test="userid !=null">
                userid,
            </if>
            <if test="iscontribute!=null">
                iscontribute,
            </if>
            <if test="hotimgurl!=null">
                hotimgurl,
            </if>
            <if test="ishot!=null">
                ishot,
            </if>
            <if test="oprtime!=null">
                oprtime
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="title != null">
                #{title,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="activetype != null">
                #{activetype,jdbcType=INTEGER},
            </if>
            <if test="activefee != null">
                #{activefee,jdbcType=DOUBLE},
            </if>
            <if test="coverimg != null">
                #{coverimg,jdbcType=VARCHAR},
            </if>
            <if test="postcontent != null">
                #{postcontent,jdbcType=VARCHAR},
            </if>
            <if test="isessence != null">
                #{isessence,jdbcType=INTEGER},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=INTEGER},
            </if>
            <if test="essencedate != null">
                #{essencedate,jdbcType=TIMESTAMP},
            </if>
            <if test="isactive != null">
                #{isactive,jdbcType=INTEGER},
            </if>
            <if test="intime != null">
                #{intime,jdbcType=TIMESTAMP},
            </if>
            <if test="userid!=null">
                #{userid,jdbcType=INTEGER},
            </if>
            <if test="iscontribute!=null">
                #{iscontribute,jdbcType=INTEGER},
            </if>
            <if test="hotimgurl!=null">
                #{hotimgurl,jdbcType=VARCHAR},
            </if>
            <if test="ishot!=null">
                #{ishot,jdbcType=INTEGER},
            </if>
            <if test="oprtime!=null">
                #{oprtime,jdbcType=TIMESTAMP}
            </if>
        </trim>
    </insert>
    <insert id="insertPerid" parameterType="com.movision.mybatis.period.entity.Period">
        <selectKey keyProperty="id" order="AFTER" resultType="Integer">
            select LAST_INSERT_ID()
        </selectKey>
        insert into yw_active_period
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>

            <if test="postid != null">
                postid,
            </if>
            <if test="begintime != null">
                begintime,
            </if>
            <if test="endtime != null">
                endtime
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>

            <if test="postid != null">
                #{postid,jdbcType=INTEGER},
            </if>
            <if test="begintime != null">
                #{begintime,jdbcType=TIMESTAMP},
            </if>

            <if test="endtime != null">
                #{endtime,jdbcType=TIMESTAMP}
            </if>

        </trim>
    </insert>

    <select id="queryPostByIdEcho" resultType="com.movision.mybatis.post.entity.PostCompile"
            parameterType="java.lang.Integer">
        SELECT p.id,p.title,p.subtitle,p.type,p.circleid,
        (SELECT name FROM yw_circle WHERE id=p.circleid AND status=1 AND isdel=0) as circleidCN,
        (SELECT category FROM yw_circle WHERE id=p.circleid AND status=1 AND isdel=0)as category,p.ishot,p.userid,
        (SELECT nickname FROM yw_user WHERE id=p.userid) as nickname,p.coverimg,
        p.isessence,p.essencedate as time,p.orderid,p.postcontent,v.videourl vid,v.bannerimgurl
        FROM yw_post as p LEFT JOIN yw_video as v ON p.id=v.postid WHERE p.id=#{postid,jdbcType=INTEGER} AND
        p.isactive=0 AND p.isdel=0
    </select>


    <select id="findAllpostSearch" parameterType="com.movision.mybatis.post.entity.PostSpread"
            resultType="com.movision.mybatis.post.entity.PostList">
        <if test="cirlceid==null">
        SELECT p.*,u.nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid) AS category
        FROM yw_post AS p LEFT JOIN yw_user u ON u.id=p.userid
        WHERE p.isdel=0 AND p.isactive=0
        <if test="uid!=null">
            AND u.id=#{uid,jdbcType=INTEGER}
        </if>
        <if test="price==5">
            AND p.isactive=0
        </if>
        <if test="price==6">
            AND p.isessence=1
        </if>
        <if test="title!=null">
            AND p.title LIKE concat('%',#{title,jdbcType=VARCHAR},'%')
        </if>
        <if test="userid!=null">
            AND p.userid=#{userid,jdbcType=INTEGER}
        </if>
        <if test="postcontent!=null">
            AND p.postcontent LIKE concat('%',#{postcontent,jdbcType=VARCHAR},'%')
        </if>
        <if test="circleid!=null">
            AND p.circleid=#{circleid,jdbcType=INTEGER}
        </if>
        <if test="endtime!=null and begintime!=null">
            AND p.intime BETWEEN #{begintime,jdbcType=DATE} AND #{endtime,jdbcType=DATE}
        </if>
        <if test="essencedate!=null">
            AND p.essencedate=#{essencedate,jdbcType=DATE}
        </if>
        <if test="pai==0">
            ORDER BY intime DESC
        </if>
        <if test="pai==1">
            ORDER BY totalpoint DESC
        </if>
        </if>
        <if test="circleid!=null">
            SELECT p.*,u.nickname,
            (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
            (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
            (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
            (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid) AS circlename,
            (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid) AS category
            FROM yw_post AS p LEFT JOIN yw_user u ON u.id=p.userid
            WHERE p.isdel=0 AND p.isactive=0 AND p.circleid IN
            <foreach collection="array" item="item" open="(" separator="," close=")">
                #{circleids,jdbcType=INTEGER}
            </foreach>
            <if test="uid!=null">
                AND u.id=#{uid,jdbcType=INTEGER}
            </if>
            <if test="price==5">
                AND p.isactive=0
            </if>
            <if test="price==6">
                AND p.isessence=1
            </if>
            <if test="title!=null">
                AND p.title LIKE concat('%',#{title,jdbcType=VARCHAR},'%')
            </if>
            <if test="userid!=null">
                AND p.userid=#{userid,jdbcType=INTEGER}
            </if>
            <if test="postcontent!=null">
                AND p.postcontent LIKE concat('%',#{postcontent,jdbcType=VARCHAR},'%')
            </if>
            <if test="endtime!=null and begintime!=null">
                AND p.intime BETWEEN #{begintime,jdbcType=DATE} AND #{endtime,jdbcType=DATE}
            </if>
            <if test="essencedate!=null">
                AND p.essencedate=#{essencedate,jdbcType=DATE}
            </if>
            <if test="pai==0">
                ORDER BY intime DESC
            </if>
            <if test="pai==1">
                ORDER BY totalpoint DESC
            </if>
        </if>
    </select>

    <select id="findAllQueryCircleByPostList" parameterType="java.lang.String"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.circleid,p.id,p.title,u.nickname,p.collectsum,
        (SELECT COUNT(1) FROM yw_post_share s WHERE s.postid=p.id) AS share,
        (SELECT COUNT(1) FROM yw_post_comment c WHERE c.postid=p.id) AS commentsum,p.zansum,
        (SELECT COALESCE(SUM(points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COUNT(1) FROM yw_post_accusation a WHERE a.postid=p.id) AS accusation,cir.name AS circlename,
        p.orderid,p.essencedate
        FROM yw_post AS p LEFT JOIN yw_user as u ON u.id=p.userid LEFT JOIN yw_circle cir ON cir.id=p.circleid
        WHERE 1
        <if test="categoryid!=null">
            AND p.circleid IN (SELECT id FROM yw_circle WHERE category=#{categoryid,jdbcType=INTEGER})
        </if>
        <if test="circleid!=null">
            AND p.circleid=#{circleid,jdbcType=INTEGER}
        </if>
        AND p.isdel=0 ORDER BY p.intime DESC

    </select>
    <select id="findAllActivePostCondition" resultType="com.movision.mybatis.post.entity.PostActiveList"
            parameterType="com.movision.mybatis.post.entity.PostActiveList">
        SELECT p.*,a.begintime,a.endtime FROM yw_post p LEFT JOIN yw_active_period a ON a.postid=p.id WHERE p.isdel=0
        AND p.isactive=1
        <if test="title!=null">
            AND p.title LIKE concat('%',#{title,jdbcType=VARCHAR},'%')
        </if>
        <if test="userid!=null">
            AND p.userid = #{userid,jdbcType=INTEGER}
        </if>
        <!-- in(select id from yw_user WHERE nickname LIKE concat('%',#{name,jdbcType=VARCHAR},'%')) -->
        <if test="content!=null">
            AND p.postcontent LIKE concat('%',#{content,jdbcType=VARCHAR},'%')
        </if>

        <if test="begintime!=null and endtime!=null">
            <!--AND p.intime BETWEEN #{begintime,jdbcType=DATE} AND #{endtime,jdbcType=DATE}-->
            AND (((#{begintime,jdbcType=DATE}  <![CDATA[<]]> a.begintime) AND (#{endtime,jdbcType=DATE} <![CDATA[>]]>
            a.endtime))
            OR ((#{endtime,jdbcType=DATE} <![CDATA[>]]> a.begintime) AND (#{begintime,jdbcType=DATE} <![CDATA[<]]>
            a.begintime))
            OR ((#{endtime,jdbcType=DATE} <![CDATA[>]]> a.endtime) AND (#{begintime,jdbcType=DATE} <![CDATA[<]]>
            a.endtime))
            OR ((#{endtime,jdbcType=DATE} <![CDATA[<]]> a.endtime) AND (#{begintime,jdbcType=DATE} <![CDATA[>]]>
            a.begintime)))
        </if>

        <!-- 未开始 -->
        <if test="statue==0">
            AND a.begintime  <![CDATA[>]]> NOW()
        </if>
        <!-- 结束 -->
        <if test="statue==1">
            AND NOW() <![CDATA[>]]> a.endtime
        </if>
        <!-- 报名中 -->
        <if test="statue==2">
            AND ((NOW()  <![CDATA[>]]> a.begintime) AND (NOW() <![CDATA[<]]> a.endtime))
        </if>

        <if test="loginid!=null">
            AND userid=#{loginid,jdbcType=INTEGER}
        </if>
        <if test="pai==0">
            ORDER BY p.intime DESC
        </if>
        <if test="pai==1">
            ORDER BY (SELECT COUNT(1) persum FROM yw_active_part) DESC
        </if>
    </select>

    <insert id="insertGoods" parameterType="java.util.Map">
        insert into yw_post_share_goods
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>

            <if test="postid != null">
                postid,
            </if>
            <if test="goodsid != null">
                goodsid
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>

            <if test="postid != null">
                #{postid,jdbcType=INTEGER},
            </if>
            <if test="goodsid != null">
                #{goodsid,jdbcType=INTEGER}
            </if>
        </trim>
    </insert>

    <insert id="insertPromotionGoods" parameterType="java.util.Map">
        insert into yw_active_goods
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>

            <if test="postid != null">
                postid,
            </if>
            <if test="goodsid != null">
                goodid
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>

            <if test="postid != null">
                #{postid,jdbcType=INTEGER},
            </if>
            <if test="goodsid != null">
                #{goodsid,jdbcType=INTEGER}
            </if>
        </trim>
    </insert>

    <select id="findAllMyCollectPost" resultType="com.movision.mybatis.post.entity.Post">
        SELECT p.*
        FROM yw_post p
        LEFT JOIN yw_collection c on p.id = c.postid
        where c.type = 0
        <if test="userid!=null and userid!=''">
            AND c.userid = #{userid}
        </if>
        ORDER BY c.collect_time DESC
    </select>

    <select id="queryMyPostList" resultType="com.movision.mybatis.post.entity.Post">
        SELECT *
        FROM yw_post
        WHERE isdel = 0
        and userid = #{userid}
        ORDER BY intime DESC
    </select>
    <select id="queryActiveById" parameterType="java.lang.Integer"
            resultType="com.movision.mybatis.post.entity.PostActiveList">
        SELECT p.*,a.begintime,a.endtime,u.nickname FROM yw_post p LEFT JOIN yw_active_period a ON a.postid=p.id LEFT
        JOIN yw_user u ON u.id=p.userid
        WHERE p.isdel=0 AND p.isactive=1 AND p.id=#{id,jdbcType=INTEGER}
    </select>

    <select id="queryPostByIsessence" parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT isessence FROM yw_post WHERE id=#{id,jdbcType=INTEGER}
    </select>

    <update id="updatePostChoiceness" parameterType="com.movision.mybatis.post.entity.PostTo">
        UPDATE yw_post SET
        <if test="essencedate != null">
            essencedate = #{essencedate,jdbcType=DATE},
        </if>
        <if test="subtitle!=null">
            subtitle=#{subtitle,jdbcType=VARCHAR},
        </if>
        <if test="orderid!=null">
            orderid=#{orderid,jdbcType=INTEGER},
        </if>
        isessencepool=0
        WHERE id=#{id,jdbcType=INTEGER} AND isessence=1 AND isdel=0
    </update>

    <select id="findAllQueryCollectPostList" parameterType="java.lang.String"
            resultType="com.movision.mybatis.post.entity.PostList">
        SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
        (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
        (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
        (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
        (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid) AS circlename,
        (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid) AS category
        FROM yw_post AS p
        WHERE p.isdel=0 AND p.isactive=0 AND p.id IN (SELECT postid FROM yw_collection WHERE userid=#{userid,jdbcType=INTEGER}) ORDER BY p.intime DESC

    </select>
    <select id="activeIsHot" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT ishot FROM yw_post WHERE id=#{id,jdbcType=INTEGER}
    </select>
    <update id="updateIshot" parameterType="java.lang.Integer">
        update yw_post SET ishot=1 WHERE id=#{id,jdbcType=INTEGER}
    </update>
    <update id="updateNoIshot" parameterType="java.lang.Integer">
        update yw_post SET ishot=0 WHERE id=#{id,jdbcType=INTEGER}
    </update>

    <select id="queryUserByPostid" parameterType="java.lang.String" resultType="java.lang.Integer">
        select userid from yw_post WHERE id=#{postid,jdbcType=INTEGER}
    </select>

    <update id="addPostByisessencepool" parameterType="java.lang.Integer">
        UPDATE yw_post SET isessencepool=1 WHERE id=#{postid,jdbcType=INTEGER}
    </update>

    <select id="findAllqueryPostByIsessencepoolList" resultType="com.movision.mybatis.post.entity.PostList">
    SELECT p.*,(SELECT u.nickname FROM yw_user u WHERE u.id=p.userid) as nickname,
    (SELECT COUNT(1) FROM yw_post_share sh WHERE sh.postid=p.id) as share,
    (SELECT COALESCE(SUM(r.points),0) FROM yw_post_rewarded r WHERE r.postid=p.id) AS rewarded,
    (SELECT COALESCE(SUM(ac.num),0) FROM yw_post_accusation ac WHERE ac.postid =p.id) AS accusation,
    (SELECT name FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS circlename,
    (SELECT category FROM yw_circle cir WHERE cir.id=p.circleid AND cir.isdel=0 AND cir.status=1) AS category
    FROM yw_post AS p
    WHERE p.isdel=0 AND p.isactive=0 AND p.isessencepool=1 ORDER BY p.intime DESC
    </select>

</mapper>